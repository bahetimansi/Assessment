package com.assessment.service;

import java.util.ArrayList;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;

import com.assessment.integration.ApiService;
import com.assessment.integration.LoanEmiResponse;
import com.assessment.model.EmiDetails;
import com.assessment.model.LoanDetails;
import com.assessment.model.LoanEmi;
import com.assessment.model.LoanResponse;
import com.assessment.repository.EmiDetailsRepository;
import com.assessment.repository.LoanDetailsRepository;
import com.assessment.repository.LoanEmiRepository;

public class LoanService {

	@Autowired
	private ApiService apiService;
	
	@Autowired
	private EmiDetailsRepository emiDetailsRepository;
	
	private LoanDetailsRepository loanDetailsRepository;
	
	private LoanEmiRepository loanEmiRepository;
	
	public LoanResponse getLoanData(String loanAccountNumber) {
		LoanEmiResponse externalResponse = apiService.getData();
		
	}
	
	private void saveData(LoanEmiResponse externalResponse) {
		List<EmiDetails> emiDetailsList = new ArrayList<>();
		LoanDetails loanDetails = new LoanDetails();
		loanDetails.setLoanAccountNumber(externalResponse.getLoanAccountNumber());
		loanDetails.setEmiDay(15);
		if(externalResponse.getEmiDetails() != null && !externalResponse.getEmiDetails().isEmpty()) {
			for(EmiDetails emiDetails : externalResponse.getEmiDetails()) {
				emiDetailsList.add(emiDetailsRepository.save(emiDetails));
			}
		}
		loanDetails = loanDetailsRepository.save(loanDetails);
		List<LoanEmi> loanEmiList = new ArrayList<>();
		for(EmiDetails emiDetails : emiDetailsList) {
			LoanEmi loanEmi = new LoanEmi();
			loanEmi.setLoanId(loanDetails.getId());
			loanEmi.setEmiId(emiDetails.getId());
			loanEmiList.add(loanEmi);
		}
		loanEmiRepository.saveAll(loanEmiList);
	}
}
